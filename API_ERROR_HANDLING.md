# Обработка ошибок Google Sheets API

## Текущая реализация

### ✅ Защита от блокировки функционала

**1. По умолчанию Google Sheets отключен:**
- `USE_GOOGLE_SHEETS_FOR_WRITES = False` - бот не пишет в Google Sheets при выполнении команд
- `USE_GOOGLE_SHEETS_FOR_READS = False` - бот не читает из Google Sheets (использует только PostgreSQL)

**2. Приоритеты загрузки данных:**
```
ПРИОРИТЕТ 1: PostgreSQL (основной источник)
    ↓ (если недоступен)
ПРИОРИТЕТ 2: Google Sheets (только если USE_GOOGLE_SHEETS_FOR_READS=True)
    ↓ (если недоступен или ошибка)
ПРИОРИТЕТ 3: Локальные файлы (fallback)
```

**3. Обработка ошибок API:**

**Чтение (`read_all_rows`):**
- При ошибке API возвращается пустой список `[]`
- Код автоматически переходит к следующему источнику (локальные файлы)
- **Не блокирует работу бота**

**Запись (`write_rows`, `append_row`):**
- При ошибке 429 (rate limit) данные добавляются в буфер
- Функция возвращает `False`
- **Не блокирует работу бота** - данные уже сохранены в PostgreSQL

**4. Rate Limit Protection:**
- `_check_rate_limit()` проверяет лимиты перед запросом
- Низкоприоритетные запросы (логи) пропускаются при достижении лимита
- Высокоприоритетные запросы выполняются, но с предупреждением

### ✅ Гарантии

1. **Все данные сохраняются в PostgreSQL** - основной источник истины
2. **Ошибки Google Sheets API не блокируют работу бота**
3. **Есть fallback на локальные файлы** при недоступности PostgreSQL и Google Sheets
4. **Буферизация операций** - данные не теряются при rate limit

### ⚠️ Рекомендации

**Для максимальной надежности:**
- Оставить `USE_GOOGLE_SHEETS_FOR_WRITES = False` (по умолчанию)
- Оставить `USE_GOOGLE_SHEETS_FOR_READS = False` (по умолчанию)
- Google Sheets используется только для синхронизации (раз в 10 минут) и как веб-интерфейс

**Если нужно включить чтение из Google Sheets:**
- Убедиться, что PostgreSQL доступен как основной источник
- Ошибки API будут обрабатываться корректно, но могут замедлить работу

